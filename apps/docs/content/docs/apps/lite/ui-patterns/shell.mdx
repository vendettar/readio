---
title: Overlays & Shell
---

## App Boot Sequence

- **Boot Loader**: During initial application hydration (loading subscriptions, favorites, and restoring player sessions from IndexedDB), a `BootLoader` splash screen is displayed.
- **Visuals**: Centered Logo (`readio.svg`) with a smooth "breathing" animation (opacity and scale pulses). 
- **Transition**: Use `AnimatePresence` to fade out the loader once the `isReady` state from `useAppInitialization` is true.
- **Constraint**: Must use `fixed inset-0 z-50 bg-background` to perfectly cover all "empty" content flashes.

## Overlays & Menus

- **Dropdowns**: Use the "Premium Overlay" style (`glassmorphism`, `sideOffset={8}`, `rounded-xl`, `backdrop-blur-xl`, `backdrop-saturate-150`).
- **Inline Actions**: Use `modal={false}` on `DropdownMenu` when the action triggers inline editing (e.g., Rename) to prevent focus locking issues.
- **Multi-Step Menus**: Implement confirmation steps **inside** the menu content (Panel-Grid pattern) rather than opening a new Dialog on top.
- **No Global Overlay Store**: Keep `isOpen` state local to the component; standardize layering with shared z-index tokens instead of global modal state.

### 3-dot Action Menus (Overflow Menus)
- **Component Choice**: Use `DropdownMenu` for action lists. Use `Popover` only for non-interactive rich content or info.
- **Positioning**: `sideOffset={8}` and `collisionPadding={16}` are required for all 3-dot menus.
- **Modal Mode**: Use `modal={false}` when an action triggers inline editing (rename, inline inputs).
- **Event Isolation**: Stop propagation on trigger and content when nested inside clickable rows/cards.
- **Overflow Hidden**: Only allowed for multi-panel sliding menus (e.g., menu → confirm). Avoid for single-panel menus.
- **Default Wrapper**: Prefer `src/components/ui/overflow-menu.tsx` for standard cases to keep behavior consistent.

### Surface Decision Tree (Which Component?)
- **Is it a critical confirmation?** (Delete, Wipe) -> **`AlertDialog`** (Must require explicit action).
- **Is it a complex form/content?** (Settings, Edit Details) -> **`Dialog`** (Modal, centers screen).
- **Is it contextual?** (Action menu, Filters) -> **`DropdownMenu`** or **`Popover`** (Anchored to trigger).
- **Is it transient info?** (Hover info) -> **`Tooltip`**.

---

## Feedback & Notifications (Toast)

- **Standard**: Use **Sonner** via the centralized helper `src/lib/toast.ts`.
  - **Why**: Sonner provides better stacking, promises, and visuals than Radix Toast.
- **Forbidden**: Do NOT create custom `fixed` overlay divs for notifications.
- **Async Pattern**: Use `toast.promise` for async actions (like file processing) to give immediate feedback.
- **Key Rule**: Use `toast.*Key` (e.g., `toast.successKey('key', { var })`) for i18n support. Key → text translation MUST happen inside `src/lib/toast.ts` via `i18next.t`; call sites should never call translation functions inside toast arguments.
- **Usage**:
  ```tsx
  import { toast } from '@/lib/toast'
  // ✅ Correct
  toast.successKey('saved')
  toast.errorKey('failed')
  ```

---

## Tooltips

- **Rule**: All icon-only buttons MUST have a Tooltip.
- **Implementation**: Use shadcn `Tooltip` primitives.
- **Forbidden**: Do NOT use the native HTML `title="..."` attribute (it looks ugly and is not accessible).
- **Delay**: Use standard delay (default) to avoid UI flickering.
- **Example**: `SleepTimerButton` uses a `Tooltip` wrapping a `DropdownMenuTrigger` to show remaining time on hover while allowing timer selection on click.

---

## Planned (Pending Execution)

- **Feedback Links**: Settings section for GitHub Issues and support email (Instruction 052).
- **Overlay Layering Standardization**: Portal + z-index tokens audit (Instruction 071).
