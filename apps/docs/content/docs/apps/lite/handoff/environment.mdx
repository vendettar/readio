---
title: Development Environment
---

## 0. Prerequisites (Engines)

To ensure consistency across environments, we enforce specific tool versions via `package.json` engines and `engine-strict=true` in `.npmrc`:

- **Node.js**: `>=20.0.0`
- **pnpm**: `>=10.28.0`

If your local environment does not meet these requirements, `pnpm install` will fail.

## 1. Local Development / Build / Test

Build and Test Scripts (Execute in root directory): `pnpm build`, `pnpm test`, `pnpm --filter @readio/lite test:run`, `pnpm --filter @readio/lite test:e2e`.
Code Quality Tools: Biome (`pnpm lint`, `pnpm format`).

### Standard Dependencies
- **Date Manipulation**: `date-fns` is the officially adopted library for all date formatting and calculations. Manual parsing or alternative libraries (moment, lodash) are prohibited.

### Planned (Pending Execution)
- Deployment pipeline for Vercel/Docker (Instruction 038).
- CI pipeline via GitHub Actions (Instruction 044).
- PWA update lifecycle handling (Instruction 043).
- PWA audio range cache (Instruction 060).
- Proxy failover mechanism (Instruction 062).
- Browser support matrix (Instruction 065).
- Turborepo cache hardening (Instruction 066).
- Lighthouse CI budget (Instruction 077).
- Dependency audit & license policy (Instruction 078).

### Testing Strategy

#### Unit Tests (Vitest)

- Test Files: `src/__tests__/*.test.ts`
- Uses `fake-indexeddb` to mock IndexedDB
- Total 119 test cases
- Script: `pnpm --filter @readio/lite test:run` (Execute from root)

#### E2E Tests (Playwright)

- Script: `pnpm --filter @readio/lite test:e2e` (Execute from root)

---

## 2. Runtime Configuration

### Centralized Configuration (`public/env.js`)

The application uses dynamic runtime configuration instead of relying solely on build-time environment variables:
- **File**: `public/env.js` (Imported directly by `index.html`)
- **Responsibility**: Manage API addresses (iTunes, Dictionary), storage limits (Audio Max Size, Cache Limit), UI parameters (Zoom, Click Delay).
- **Default Values**: Contains production defaults, can be overridden by injecting values in the deployment environment.

**Storage Cache Keys**:
- `READIO_AUDIO_CACHE_MAX_MB` (default 1024)
- `READIO_AUDIO_CACHE_TRIM_TARGET_MB` (default 800)

### Configuration Access (`src/lib/runtimeConfig.ts`)

- `getAppConfig()` provides type-safe access to configuration, supporting string-to-number conversion.
- `Window.__READIO_ENV__` defines the runtime configuration structure.

---

## 3. Common Troubleshooting

### Routes Not Working

`src/routeTree.gen.ts` is generated by the Vite plugin during development startup.

### Database Errors

The default database name is `readio` (override via `READIO_DB_NAME` for reset), and it can be viewed and cleared in the browser's IndexedDB panel.

### Tailwind Styles Not Working

The PostCSS pipeline uses `@tailwindcss/postcss` (Tailwind v4).

### Known Build Warning (Lightning CSS)

`pnpm --filter @readio/lite build` currently reports a warning for `::highlight(lookup-highlight)`. This is due to Lightning CSS lagging support for the Highlights API. Treat it as expected until the toolchain update; it is not a failure gate.
