---
title: Development Environment
---

## 0. Prerequisites (Engines)

To ensure consistency across environments, we enforce specific tool versions via `package.json` engines and `engine-strict=true` in `.npmrc`:

- **Node.js**: `>=20.0.0`
- **pnpm**: `>=10.28.0`

If your local environment does not meet these requirements, `pnpm install` will fail.

## 1. Local Development / Build / Test

Build and Test Scripts (Execute in root directory): `pnpm build`, `pnpm test`, `pnpm --filter @readio/lite test:run`, `pnpm --filter @readio/lite test:e2e`.
Code Quality Tools: Biome (`pnpm lint`, `pnpm format`).

### Standard Dependencies

The following libraries form the **Phase 1 Baseline** — they are pre-installed and ready for Phase 2+ refactors:

| Category | Library | Purpose |
|----------|---------|---------|
| **Date** | `date-fns` | Date formatting and calculations. Manual parsing is prohibited. |
| **I18n** | `i18next`, `react-i18next`, `i18next-browser-languagedetector` | Internationalization framework (pending full migration). |
| **Forms** | `react-hook-form`, `@hookform/resolvers`, `zod` | Form state management with Zod validation. |
| **File Drop** | `react-dropzone` | Standard file drop zone handling. |
| **Toast** | `sonner` | Modern toast notifications (pending migration from Radix Toast). |
| **Animation** | `framer-motion` | Production-grade animations. |
| **Hotkeys** | `react-hotkeys-hook`, `@use-gesture/react` | Keyboard shortcuts and gesture handling. |

### PWA & Native Sharing [Implemented]

Readio is configured as a high-quality PWA:
- **Manifest**: `public/manifest.json` defines standalone display, theme colors, and icons.
- **iOS Hardening**: `index.html` includes Apple-specific meta tags (`apple-mobile-web-app-capable`, `apple-touch-icon`).
- **Native Sharing**: `src/components/Player/ShareButton.tsx` integrates with `navigator.share` API for native sharing on mobile, with clipboard fallback for desktop.

### Deployment [Implemented]

Readio supports automated deployment via Vercel and manual self-hosting via Docker.

#### Vercel (Default)
- **Configuration**: `vercel.json` at repo root.
- **Build Command**: `pnpm --filter @readio/lite build`
- **Output Directory**: `apps/lite/dist`
- **SPA Routing**: Mandatory rewrite rule redirects all paths to `index.html`.
- **Environment Variables**:
  - `READIO_DB_NAME`: (Optional) Override default IndexedDB name.
  - `READIO_RSS_FEED_BASE_URL`: (Optional) Base URL for RSS proxy.
  - `READIO_DISCOVERY_SEARCH_URL`: (Optional) iTunes search API endpoint.

#### Docker (Self-Host)
- **Image**: `Dockerfile` at repo root using `nginx:alpine`.
- **Nginx Config**: `nginx.conf` handles SPA routing via `try_files`.
- **Build Steps**:
  1. `docker build -t readio-lite .`
  2. `docker run -p 8080:80 readio-lite`

### Planned (Pending Execution)
- CI pipeline via GitHub Actions (Instruction 044).
- PWA update lifecycle handling (Instruction 043).
- PWA audio range cache (Instruction 060).
- Proxy failover mechanism (Instruction 062).
- Browser support matrix (Instruction 065).
- Turborepo cache hardening (Instruction 066).
- Lighthouse CI budget (Instruction 077).
- Dependency audit & license policy (Instruction 078).

### Testing Strategy

#### Unit Tests (Vitest)

- Test Files: `src/__tests__/*.test.ts`
- Uses `fake-indexeddb` to mock IndexedDB
- Total 119 test cases
- Script: `pnpm --filter @readio/lite test:run` (Execute from root)

#### E2E Tests (Playwright)

- Script: `pnpm --filter @readio/lite test:e2e` (Execute from root)

---

## 2. Runtime Configuration

### Centralized Configuration (`public/env.js`)

The application uses dynamic runtime configuration instead of relying solely on build-time environment variables:
- **File**: `public/env.js` (Imported directly by `index.html`)
- **Responsibility**: Manage API addresses (iTunes, Dictionary), storage limits (Audio Max Size, Cache Limit), UI parameters (Zoom, Click Delay).
- **Default Values**: Contains production defaults, can be overridden by injecting values in the deployment environment.

**Storage Cache Keys**:
- `READIO_AUDIO_CACHE_MAX_MB` (default 1024)
- `READIO_AUDIO_CACHE_TRIM_TARGET_MB` (default 800)

### Configuration Access (`src/lib/runtimeConfig.ts`)

- `getAppConfig()` provides type-safe access to configuration. It uses Zod coercion and defaults as the single source of truth (SSOT), automatically handling type conversions:
  - **String to Number**: `"123"` → `123`.
  - **Boolean Coercion**: Handles `"false"`, `"0"`, and case-insensitive `"trash"` (any unknown string) as `false`; only explicit `"true"`/`"1"` (case-insensitive) are `true`.
- `Window.__READIO_ENV__` defines the runtime configuration structure.
- **Dictionary API Base**: Use `READIO_DICTIONARY_API_URL`. Lookup URLs are constructed via `new URL(word, base)` so trailing `/` is optional.

---

## 3. Common Troubleshooting

### Routes Not Working

`src/routeTree.gen.ts` is generated by the Vite plugin during development startup.

### Database Errors

The default database name is `readio-lite` (override via `READIO_DB_NAME` for reset), and it can be viewed and cleared in the browser's IndexedDB panel.

### Tailwind Styles Not Working

The PostCSS pipeline uses `@tailwindcss/postcss` (Tailwind v4).

### Known Build Warning (Lightning CSS)

`pnpm --filter @readio/lite build` currently reports a warning for `::highlight(lookup-highlight)`. This is due to Lightning CSS lagging support for the Highlights API. Treat it as expected until the toolchain update; it is not a failure gate.
