---
title: 路由策略
---

# 路由策略

Readio Lite 使用 **TanStack Router** 进行基于文件的路由。
本文档定义了 URL 结构、导航模式和 Slug 策略。

## 1. URL 结构

| 路由 | 模式 | 描述 |
|---|---|---|
| Home | `/` | 使用 `beforeLoad` 重定向到 `/files` (如果未找到会话)。 |
| Podcast | `/podcast/$id` | 播客详情页。`$id` 是 Provider ID (例如 iTunes ID)。支持 `?fromLayoutPrefix` 参数用于上下文感知的位移动画。 |
| Episode | `/podcast/$id/episode/$episodeId` | 单集详情。见下文“Slug 策略”。 |
| Files | `/files/*` | 本地文件浏览器。使用通配符表示文件夹路径。 |
| Legal | `/legal/privacy`, `/legal/terms` | 隐私政策与服务条款。 |

## 2. Slug Strategy (混合 ID)

由于 Readio Lite 是一个没有 slug 数据库查找的客户端应用，我们对 Episode URL 使用 **混合 ID (Hybrid ID)** 模式。

**格式**: `readable-title-{shortId}`
- **readable-title**: 从单集标题生成 (用于人类/SEO)。
- **shortId**: Episode GUID 的前 8 个字符 (用于 Router)。

**示例**:
`/podcast/123/episode/how-i-built-this-a1b2c3d4`

**解析逻辑**:
1. Router 提取 `episodeId` 参数 (`how-i-built-this-a1b2c3d4`)。
2. `extractIdFromSlug()` 按 `-` 分割并取最后一部分 (`a1b2c3d4`)。
3. 应用在 RSS feed 中搜索 `id.startsWith('a1b2c3d4')` 的单集。

**为什么?**
- **无状态**: 不需要后端查找表。
- **弹性**: 标题更改不会破坏链接 (只要 ID 保持不变)。
- **可读**: 用户可以从 URL 中读取内容主题。

## 3. 导航规则

- **预加载**: 在路由定义中使用 `loader` 在渲染组件 *之前* 获取 Podcast Feed 数据。
- **重定向**: **不要** 在渲染体中使用 `return <Navigate />`。在 `beforeLoad` 或 `loader` 内部使用 `throw redirect()`。
- **持久化**: Audio Player 组件位于 `__root.tsx` 中，在所有路由更改中持久存在。

---

## 计划中（待执行）

- **单集排序/筛选参数**：使用查询参数驱动状态（指令 054）。

