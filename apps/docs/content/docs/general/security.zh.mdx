---
title: 安全与隐私
---

# 安全与隐私标准

Readio 致力于用户数据主权和绝对安全。

---

## 1. HTML 净化 (反 XSS)

**规则**: 绝不要直接使用 `dangerouslySetInnerHTML` 处理来自 RSS 源或文件的原始数据。
- **严格要求**: 所有 HTML 内容在渲染前必须经过净化。
- **工具**: 使用 `DOMPurify` (通过包装器 `src/lib/htmlUtils.ts`)。
- **策略**: 仅允许安全标签 (格式化, 链接)。脚本、iframe 和跟踪像素会被剥离。

## 1.1 内容安全策略 (CSP) [已实现]
- **状态**：通过指令 041 已实现。
- **目标**：通过 **服务器/边缘层的 HTTP 响应头** 强制严格 CSP，以限制脚本、媒体与图片来源。
- **策略**：`default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: https:; media-src 'self' blob: https:; connect-src 'self' https:; font-src 'self' data: https:; frame-ancestors 'none'; base-uri 'self';`
- **灵活性**：显式允许 `connect-src` 和 `img-src` 使用 `https:` 协议，以支持用户配置的自定义 CORS 代理以及各种播客封面 CDN。
- **落地**：
  - **Vercel**：在 `vercel.json` 中通过响应头设置 `Content-Security-Policy`。
  - **Docker (Nginx)**：在 `nginx.conf` 中通过 `add_header ... always;` 设置 `Content-Security-Policy`。
  - **禁止**：不要通过 `index.html` 的 `<meta http-equiv="Content-Security-Policy">` 强制 CSP；它不是等价的控制面（尤其是 `frame-ancestors`）。

## 1.2 计划中：Iframe 沙箱
- **状态**：指令 051 计划中。
- **目标**：在需要时用沙箱 iframe 隔离不可信富文本。

## 2. 隐私与数据主权

### A. 代理隐私 (关键)
**问题**: 第三方 CORS 代理 (如 AllOrigins) 会看到你请求的每个 URL。
**规则**: 
- **用户选择**: 在设置中提供一个开关来禁用公共代理。
- **披露**: 当请求通过公共代理路由时，在 UI 中警告用户。
- **敏感数据**: 切勿通过公共代理传递身份验证标头、API 密钥或 Cookie。

### B. 错误报告隐私
**规则**: 不要收集个人身份信息 (PII)。
- **禁止**: 不要记录文件名、本地文件路径、播客标题或用户查询。
- **脱敏**: 诊断日志在写入缓冲区或导出前必须经过 `redact()` 过滤。
- **允许**: 通用错误信息、浏览器版本和匿名化堆栈（路径去除本地用户名）。
- **允许**: 通用错误代码、浏览器版本和匿名堆栈跟踪（必须从路径中剥离本地用户名）。

## 3. 外部链接
**规则**: 使用 `src/lib/openExternal.ts` 进行所有外部导航。
- **要求**: 必须包含 `rel="noopener noreferrer"`。

## 4. 本地文件安全
**规则**: App 绝不能尝试将本地媒体文件的内容上传到任何服务器。
- **处理**: 所有元数据提取 (ID3 标签) 必须在客户端发生 (通过 Web Workers)。

## 5. 依赖项
**规则**: 在没有审核其安全历史和许可证的情况下，不得添加新的 NPM 包。

---

## 计划中（待执行）

- **内容归属声明**：添加归属与申诉入口（指令 055）。
- **依赖审计与许可证策略**：CI 强制漏洞与许可证检查（指令 078）。
- **RSS 内容 CSS 隔离**：show-notes 采用 scoped reset 或 Shadow DOM（指令 082）。
