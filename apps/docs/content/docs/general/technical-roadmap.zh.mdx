---
title: 技术路线图
---

# 技术路线图与架构演进

本文档跟踪代码库的**技术演进**。
每个步骤对应 `agent/instructions/lite/` 中的一个特定指令文件。

---

## 1. 第一阶段：环境与基础设施 (Foundation)
**目标**：确保稳定、一致且标准化的开发环境。

- [ ] **001**: 设置依赖项（强制使用 `date-fns`，禁用 `lodash`）。
- [x] **002**: 标准化 `src/libs` 为 `src/lib`（已完成）。
- [ ] **003**: 加固 DevOps（Node 引擎、严格脚本）。
- [ ] **004**: Tailwind 配置（注册布局令牌）。
- [ ] **005**: 准备标准库（批量安装 i18next、dropzone、sonner 等）。

---

## 2. 第二阶段：核心架构重构 (Surgery)
**目标**：在构建功能之前修复关键的架构缺陷（数据一致性、性能）。

- [ ] **006**: 标准化数据库 ID（从 `++id` 迁移到 `UUID`）。
- [ ] **007**: 重构持久化（修复“双写”Bug）。
- [ ] **008**: 修复根布局性能（隔离音频渲染）。
- [ ] **009**: 重构路由（修复重定向逻辑）。
- [ ] **010**: 优化搜索数据（添加 Dexie 索引）。
- [ ] **011**: 类型安全的国际化过渡（为 i18next 做准备）。
- [ ] **012**: 提取公共组件 (DRY)。

---

## 3. 第三阶段：标准化 (Industrialization)
**目标**：用行业标准库替换“手写”逻辑。

- [ ] **013**: 标准化 I18n（迁移到 `react-i18next`）。
- [ ] **014**: 标准化表单 (`react-hook-form` + `zod`)。
- [ ] **015**: 标准化文件拖放 (`react-dropzone`)。

---

## 4. 第四阶段：UX 与审美升级 (Vibe)
**目标**：将外观提升至“Premium/Apple-like”水准。

- [ ] **016**: 升级 UI 设计（毛玻璃效果、语义化颜色）。
- [ ] **017**: 安装 Sonner（替换 Radix Toast）。
- [ ] **018**: 重构搜索 UI（迁移到 `cmdk`）。
- [ ] **019**: 增强交互（热键与手势）。
- [ ] **020**: 清理魔法值（移除 `z-[999]`、硬编码颜色）。
- [ ] **021**: 集成 React Bits（动画）。
- [ ] **022**: 优化排版（1.6 行高、流式缩放）。
- [ ] **023**: 共享元素过渡（Mini -> Full Player）。
- [ ] **024**: 应用启动序列（Logo 动画）。

---

## 5. 第五阶段：弹性与功能 (Product)
**目标**：现实世界中的鲁棒性（离线、电池、隐私）。

- [ ] **025**: 实现离线模式。
- [ ] **026**: 加固播放器状态机。
- [ ] **027**: 加固资源管理（撤销 Object URL）。
- [ ] **028**: 集成 Media Session API (系统同步)。
- [ ] **029**: 标签页同步（单例播放）。
- [ ] **030**: 后台性能（节电模式）。
- [ ] **031**: 逻辑属性（RTL 支持）。
- [ ] **032**: 加固音频单元测试。
- [ ] **033**: 功能：睡眠定时器 (P0)。
- [ ] **034**: 功能：OPML 导入/导出 (P0)。
- [ ] **035**: 功能：个人保险箱（完整数据导出）。
- [ ] **036**: 加固 PWA 元数据（iOS 图标）。
- [ ] **037**: 实现 URL Slugs（美化链接）。

---

## 6. 第六阶段：生产就绪 (Launch)
**目标**：为公开发布与合规做准备。

- [ ] **038**: 部署流水线（Vercel/Docker）。
- [ ] **039**: 法律页面（隐私/条款）。
- [ ] **040**: Smoke E2E 测试（Playwright）。
- [ ] **041**: 严格 CSP（安全）。
- [ ] **045**: 新手引导空状态（UX）。
- [ ] **046**: 图片兜底策略（体验）。
- [ ] **052**: 用户反馈入口（留存）。
- [ ] **055**: 内容归属声明（合规）。
- [ ] **060**: PWA 音频 Range 缓存（离线 seek）。
- [ ] **062**: 代理故障转移（韧性）。
- [ ] **063**: I18n 覆盖审计（质量）。
- [ ] **065**: 浏览器支持矩阵（兼容性）。

---

## 7. 第七阶段：工程卓越 (Future)
**目标**：多开发者协作与工程护栏。

- [ ] **042**: 数据保留策略（性能）。
- [ ] **043**: PWA 更新生命周期（UX）。
- [ ] **044**: CI 流水线（自动化）。
- [ ] **047**: 本地错误日志（可支持性）。
- [ ] **048**: 无障碍标准（合规）。
- [ ] **049**: 导入完整性校验（可靠性）。
- [ ] **050**: 包体积预算（监控）。
- [ ] **051**: Iframe 沙箱（安全）。
- [ ] **053**: 离线内容管理（可用性）。
- [ ] **054**: 单集排序与筛选（可用性）。
- [ ] **056**: 多语言排版（质量）。
- [ ] **057**: DB 访问防护（反腐）。
- [ ] **058**: MSW 测试（稳健性）。
- [ ] **059**: 架构宣言（文化）。
- [ ] **061**: 内存压测（稳定性）。
- [ ] **064**: IndexedDB 迁移引擎（可靠性）。
- [ ] **066**: Turborepo 缓存加固（构建一致性）。
- [ ] **067**: 原子写入防护（可靠性）。
- [ ] **068**: 异步竞态审计（正确性）。
- [ ] **069**: 元数据解析器升级（功能性）。
- [ ] **070**: 骨架屏系统（体验）。
- [ ] **071**: 覆盖层分层标准化（架构）。
- [ ] **072**: 媒体缓存淘汰策略（维护）。
- [ ] **073**: 网络退避与断路器（韧性）。
- [ ] **074**: 存储配额监控（体验）。
- [ ] **075**: Intl API 格式化升级（质量）。
- [ ] **076**: 细粒度错误边界（容错）。
- [ ] **077**: Lighthouse CI 预算（自动化 QA）。
- [ ] **078**: 依赖审计与许可证策略（合规）。
- [ ] **079**: 浮动 Promise 审计（可靠性）。
- [ ] **080**: 事件监听泄漏审计（性能）。
- [ ] **081**: Zustand 选择器优化（性能）。
- [ ] **082**: RSS 内容 CSS 隔离（安全）。

---

## 8. 未来阶段：“混合后端” (v2.0)
**目标**：为高级用户提供可选的云同步。

### 架构变更
```mermaid
graph TD
    A[Vite Client] -->|REST| B[Spring Boot API]
    A -->|Direct| C[IndexedDB (Offline Cache)]
    B --> D[PostgreSQL]
```

### 关键模块
1. **认证**: 基于 JWT 的无状态认证。
2. **同步引擎**: “最后写入者胜”同步策略。
3. **CORS 代理**: 自托管代理。

---

## 7. SSR 策略 (决策日志)

**结论**：**应用不需要 SSR。**
- 核心应用是一个已认证的本地仪表板。SEO 无关紧要。
