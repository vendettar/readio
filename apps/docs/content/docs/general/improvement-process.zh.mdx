---
title: Vibe 改进章程
---

# 代码审计与改进手册

本文档定义了 Agent 在完成实现任务后必须如何执行**严格、结构化的代码审计**。

此文档**仅在任务完成后**使用。
它不定义如何构建功能，仅定义如何审查它们。

此仓库还有一个单独的审计模式入口点：
- `docs/audit_system.md` (严格审计模式护栏 + 强制输出格式)

当两个文档都适用时：
- 使用 `docs/audit_system.md` 作为顶级“交战规则”
- 使用本文档获取详细程序和检查清单

---

## 0. 审计模式的目的

审计模式的存在是为了：
- 防止长期代码腐烂
- 强制执行设计系统和架构规则
- 尽早发现违规行为，防止蔓延

这是一个**仅审查模式**。

Agent 必须评估，而不是创建。

---

## 1. 审计角色与职责

当此文档处于活动状态时，Agent 充当**高级审查者**，而不是实现者。

Agent 必须：
- 客观地审查现有代码
- 识别规则违规和结构风险
- 提出最小、可操作的改进

Agent 绝不能：
- 实现更改
- 重写大部分代码
- 推测未来的功能或需求

系统完整性优先级高于局部优化。

---

## 2. 审计范围

- **仅**审查最近任务中添加或修改的代码
- 如果用户明确请求全库审计，你可以审计整个仓库
- 忽略未动过的文件（除非明确请求全库审计）
- 忽略不相关的系统或未来的关注点

如果范围不清楚，请在审查前询问澄清。

### 2.1 如何确定范围 (此仓库)

首选范围输入 (按优先级排序):
1) 用户提供的提交范围 (`A..B`) → 准确审计该范围
2) 仅最新提交 → `git show --name-only -1`
3) 最新提交 + 本地更改 → `git show --name-only -1` + `git status --porcelain`

生成文件:
- `src/routeTree.gen.ts` 是由 TanStack Router 插件生成的；仅审计正确性信号。

---

## 3. 审计优先级顺序 (强制)

所有发现必须遵循以下优先级顺序。
低优先级关注点绝不能覆盖高优先级规则。

### 3.1 设计系统与规则合规性 (最高优先级)

严格对照项目设计系统和前端规则进行验证。

检查：
- 发明的颜色、间距、排版或视觉风格
- 错误或缺失使用 Tailwind CSS
- 在适用时绕过 shadcn/ui 组件
- 不必要的原始或全局 CSS
- 违反组件作用域规则的 CSS

如果存在违规：
- 明确将其标记为 **SYSTEM VIOLATIONS**
- 解释为何违反系统
- 提出修复所需的**最小**更改

---

## 3.2 架构与结构

评估：
- 组件职责边界
- 原子结构 (atoms → components → sections)
- 可重用性与重复
- 命名清晰度和文件组织

标记：
- 重载的组件
- 包含过多逻辑的 UI 组件
- 过早或不必要的抽象

除非存在确切问题，否则不要建议架构更改。

---

## 3.3 代码质量与可维护性

检查：
- 可读性和清晰度
- 不必要的复杂性
- 降低可维护性的重复模式
- 可以简化的 props 或状态

避免：
- 仅样式的重构
- 基于偏好或主观的建议

---

## 3.4 性能与正确性 (仅当真实存在时)

仅评论：
- 明确的 bug
- 明显不必要的重新渲染
- 不正确的 effects 或依赖项数组

不要：
- 发明假设的性能问题
- 没有证据就优化

---

## 4. 改进规则

所有改进建议必须：
- 是**最小和有针对性的**
- 清楚地解释 **WHY** 更改很重要
- 清楚地解释 **WHAT** 应该改变

不要：
- 建议大型重写
- 建议更改库、框架或架构
- 建议违反设计系统的样式更改

目标是纠正，而不是完美。

---

## 5. 审查输出格式 (强制)

必须使用以下结构返回审计结果：

## Summary
- 2–5 个要点：什么是好的，什么是风险，下一步是什么

## Critical Issues
- 仅 SYSTEM VIOLATIONS 或正确性 bug
- 每个项目必须包括：
  - 位置 (文件路径 + 符号/组件名称)
  - 为何重要 (用户影响或系统规则)
  - 最小修复方向 (无大型重写)

## Improvement Suggestions
- 非关键、高 ROI 的清理
- 必须是可操作且合理的

## Optional Refactors
- 明确标记为非阻塞
- 仅当它降低未来维护成本时才包括

## Verification Checklist
- `pnpm --filter @readio/lite test:run`
- `pnpm build`
- (如果触及路由) 手动: 后退/前进, 打开/关闭 `/explore` 和 `/files`, 播放不中断

### 5.0 项目特定审查清单 (Readio)

- 播放连续性: `<audio>` 保持挂载在根目录；路由/UI 更新不得中断音频。
- 交互规则: 无嵌套交互；无全卡片覆盖；所有交互使用 shadcn/ui (`Button`/`asChild`)。
- i18n: 所有面向用户的字符串必须使用 `t(key)`；新 key 必须添加到所有语言。
- 内联样式: 仅允许 CSS 变量、虚拟化或光标定位弹出窗口；否则禁止。
- Explore 规则: 无页内搜索；无“趋势/热门”部分。
- Files 规则: 单级文件夹；密度切换；视图控制栏；重命名冲突处理。
- Dropdown/Popover: 高级覆盖样式和传播规则一致。

### 5.1 文档规则 (强制)

在接受/应用任何改进工作后：
- 更新 `apps/docs/content/docs/apps/lite/handoff/index.mdx` 以匹配实际代码状态（仅结果）。

---

## 计划中（待执行）

- **用户反馈入口**：在应用内提供反馈入口以形成改进闭环（指令 052）。
- **贡献指南与宣言**：明确指令驱动流程与交接责任（指令 059）。
